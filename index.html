import os
import git
from kaggle_secrets import UserSecretsClient

# Retrieve GitHub token securely from Kaggle secrets
user_secrets = UserSecretsClient()
GITHUB_TOKEN = user_secrets.get_secret("GITHUB_TOKEN")

# Set up the repository URL using the secured token
REPO_URL = "https://{}@github.com/emigiupponi/CryptoFiatVisualizer.git".format(GITHUB_TOKEN)

# Clone the repository if not already done
if not os.path.exists('repo'):
    repo = git.Repo.clone_from(REPO_URL, 'repo')

repo = git.Repo('repo')

# Ajustar el tamaño de los gráficos antes de exportarlos
fig_network_evolution.update_layout(width=700, height=400)
fig_vol_type_econ.update_layout(width=700, height=400)
fig_heatmap_animated.update_layout(width=700, height=400)
fig_comparative_crypto_metrics.update_layout(width=700, height=400)
fig_comparative_crypto_volumes.update_layout(width=700, height=400)
fig_stacked_bar_crypto_volumes_2024.update_layout(width=700, height=400)

# Exportar los gráficos a archivos HTML
fig_network_evolution.write_html("fig_network_evolution.html")
fig_vol_type_econ.write_html("fig_vol_type_econ.html")
fig_heatmap_animated.write_html("fig_heatmap_animated.html")
fig_comparative_crypto_metrics.write_html("fig_comparative_crypto_metrics.html")
fig_comparative_crypto_volumes.write_html("fig_comparative_crypto_volumes.html")
fig_stacked_bar_crypto_volumes_2024.write_html("fig_stacked_bar_crypto_volumes_2024.html")

# Mover archivos HTML al repositorio
os.system('cp *.html repo/')

# Commit y push a GitHub
repo.index.add([
    'fig_network_evolution.html',
    'fig_vol_type_econ.html',
    'fig_heatmap_animated.html',
    'fig_comparative_crypto_metrics.html',
    'fig_comparative_crypto_volumes.html',
    'fig_stacked_bar_crypto_volumes_2024.html'
])

repo.index.commit("Add resized crypto fiat visualizations")
repo.remote(name='origin').push()
